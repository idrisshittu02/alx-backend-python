#!/bin/bash
# kubctl-0x02 - Blue-Green Deployment Manager

echo "=== Deploying Blue version (v1) ==="
kubectl apply -f blue_deployment.yaml
kubectl rollout status deployment/django-blue

echo "=== Deploying Green version (v2) ==="
kubectl apply -f green_deployment.yaml
kubectl rollout status deployment/django-green

echo "=== Checking Pods ==="
kubectl get pods -l app=django

echo "=== Checking logs for Green version ==="
GREEN_POD=$(kubectl get pods -l app=django,version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs $GREEN_POD

echo "=== Applying Service (initially points to Blue) ==="
kubectl apply -f kubeservice.yaml
kubectl get svc django-service

echo "=== Blue-Green deployment setup complete! ==="
echo "Use 'kubectl patch service' to switch traffic to green."